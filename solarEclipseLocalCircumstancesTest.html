<html>
    <head>
        <script type="text/javascript" src="js/aajs.js"></script>
        <script type="text/javascript" src="js/risetransitset.js"></script>
        <script type="text/javascript" src="testlib.js"></script>
        <script type="text/JavaScript" src="js/planetdata.js"></script>        
        <script type="text/javascript">
            var Pages = {};

        var Location = {
            latitude  : 46.5833333333,
            longitude : 26.9666666666,
            altitude  : 167,
            
            rhoSinPhi : 0,
            rhoCosPhi : 0,
            recomputeGeocentricCoordinates : function () {
            Location.rhoSinPhi = AAJS.Globe.RadiusTimesSineGeocentricLatitude (Location.latitude, Location.altitude);
            Location.rhoCosPhi = AAJS.Globe.RadiusTimesCosineGeocentricLatitude (Location.latitude, Location.altitude);
            }

        }; 
        
        
        function PlanetPage() {}
            </script>



        <script type="text/javascript" src="js/sun.js"></script>

        <script type="text/javascript" src="js/moon.js"></script>
        <script type="text/javascript" src="js/matrix.js"></script>
        <script type="text/javascript" src="js/numerical.js"></script>

       <script type="text/javascript" src="js/notifications.js"></script>
       <script type="text/javascript" src="js/mooneclipsesdata.js"></script>
        <script type="text/JavaScript" src="js/besselianelements.js"></script>
       <script type="text/javascript" src="js/solareclipsesdata.js"></script>
        <style>
            p {
                line-spacing: 2px;
            }
        </style>
    </head>
    <body>
    </body>
</html>
<script type="text/javascript">
         
    (function () {
            
        var tests = [
                
        {
            name : "Low precision local circumstances for eclipse 1984-05-30 17:30 UTC",
            input : {"T0" : AAJS.Date.DateToJD (1984, 5, 30, true) + 13/24,
                     "t" : 4.5 },
            expectedOutput :  {"x" : 0.32478, "y" : 0.36709, "local_x" : 0.647782, "local_y" : 0.7590271},
            actualOutput : {},
            test : function () {
                
                var elements = SolarEclipses.ComputeBesselianElements (this.input.T0);
                
                function _poly (coeffs, time) {
                    var val = 0;
                    var poweredTime = 1;
                    for (var i = 0; i < coeffs.length;i++) {
                        val += coeffs[i] * poweredTime;
                        poweredTime *= time;
                    }
                    return val;
                }
                
                
                this.actualOutput['x'] = _poly (elements.x, this.input.t);
                this.actualOutput['y'] = _poly (elements.y, this.input.t);

                this.actualOutput['local_x'] = _poly (elements.besselianEngine.localCircumstancesLSF.x, this.input.t);
                
                this.actualOutput['local_y'] = _poly (elements.besselianEngine.localCircumstancesLSF.y, this.input.t);
               
                if (!
                      testlib.doubleEq (this.expectedOutput.x,
                                          this.actualOutput.x,   2e-2) 
                                          )
                                          return false;
                if (!                          
                      testlib.doubleEq (this.expectedOutput.y,
                                          this.actualOutput.y,   5e-3) )
                                          return false;
                 if (!                         
                      testlib.doubleEq (this.expectedOutput.local_x,
                                          this.actualOutput.local_x,   3e-2) )
                                          return false;
                 if (!                         
                      testlib.doubleEq (this.expectedOutput.local_y,
                                          this.actualOutput.local_y,   1e-2) )
                                          return false;
                                          
                return true;
            }
        },

 
        
        
        ];
            
        testlib.runTests (tests);
    })();
                
        </script>

