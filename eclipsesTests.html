<html>
    <head>
        <script type="text/javascript" src="js/aajs.js"></script>
        <script type="text/javascript" src="testlib.js"></script>

        <script type="text/javascript">
            var Pages = {};

        var Location = {
            latitude : 0,
            longitude : 0,
            altitude : 0
        }; 
        
        function PlanetPage() {}
            </script>



        <script type="text/javascript" src="js/sun.js"></script>
        <script type="text/JavaScript" src="js/planetdata.js"></script>
       <script type="text/javascript" src="js/jupiter.js"></script>
       <script type="text/javascript" src="js/mars.js"></script>
       <script type="text/javascript" src="js/mercury.js"></script>
       <script type="text/javascript" src="js/neptune.js"></script>
       <script type="text/javascript" src="js/saturn.js"></script>
        <script type="text/javascript" src="js/moon.js"></script>
       <script type="text/javascript" src="js/uranus.js"></script>
       <script type="text/javascript" src="js/venus.js"></script>
       <script type="text/javascript" src="js/notifications.js"></script>
       <script type="text/javascript" src="js/mooneclipsesdata.js"></script>
        <style>
            p {
                line-spacing: 2px;
            }
        </style>
    </head>
    <body>
    </body>
</html>
<script type="text/javascript">
         
    (function () {
            
        var tests = [
                
        {
            name : "JD to K and back",
            input : AAJS.Date.DateToJD (1992, 4, 12, true),
            expectedOutput :  AAJS.Date.DateToJD (1992, 4, 12, true),
            actualOutput : false,
            test : function () {
                var k = AAJS.Moon.kForJD (this.input);
                this.actualOutput = AAJS.Moon.JDforK (k);
                return this.actualOutput == this.expectedOutput;
            }
        },

        {
            name : "getOppositionAroundJD (1985-05-04)",
            input : AAJS.Date.DateToJD (1985, 05, 04, true),
            expectedOutput :  AAJS.Date.DateToJD (1985, 05, 04, true) + (19 + 36.3/60)/24,
            actualOutput : false,
            test : function () {
                this.actualOutput = MoonEclipsesData.getOppositionAroundJD (this.input).oppositionJD;
                return testlib.doubleEq (this.actualOutput, this.expectedOutput, 4e-3);
            }
        },
        
        {
            name : "opposition data for 1985-05-04",
            input : AAJS.Date.DateToJD (1985, 05, 04, true),
            expectedOutput : {
                    "RaSun" : (2 + (47 + 13.8/60)/60) * 15,
                    "DecSun" : 16 + (7 + 21.7/60)/60,
                    "RaMoon" : (14 + (47 + 13.8/60)/60) * 15,
                    "DecMoon" : -(15 + (42 + 37.4/60)/60),
                    
                    "dRaSun" : 9.6/3600 * 15,
                    "dDecSun": 43.3/3600,
                    "dRaMoon" : (2 + 23.6/60)/60 * 15,
                    "dDecMoon": -(15 + 15.7/60)/60,
                    
                    "ParallaxSun" : 8.72/3600,
                    "ParallaxMoon" : (61 + 14.1/60)/60,
                    
                    "MoonDiameter" : 2 / 60 * (16 + 41/60),
                    "SunDiameter" : 2 / 60 * (15 + 53/60),
                    
                    "oppositionJD" : AAJS.Date.DateToJD (1985, 05, 04, true) + (19 + 36.3/60)/24,
                    "eclipse" : false
            },
                  
            actualOutput : false,
            errors : [4e-3, 
                      2e-3, 
                      5e-3, 
                      3e-2, 
                      
                      2e-4, 
                      1e-4, 
                      1.1e-2, 
                      2e-2, 
                      
                      2e-6, 
                      4e-4, 
                      
                      5e-3, 
                      1e-3, 
                      
                      4e-3, 
                      0],
            test : function () {
                var i = 0;
                this.actualOutput = MoonEclipsesData.getOppositionAroundJD (this.input);
                for (var key in this.expectedOutput) {
                    if (!testlib.doubleEq (this.actualOutput[key], 
                                           this.expectedOutput[key], 
                                           this.errors[i++])) {
                        return false;
                    }
                }
                return true;
            }
        },

        {
            name : "eclipse geometric data for 1985-05-04",
            input : AAJS.Date.DateToJD (1985, 05, 04, true),
            expectedOutput : {
                    "RaSun" : (2 + (47 + 13.8/60)/60) * 15,
                    "DecSun" : 16 + (7 + 21.7/60)/60,
                    "RaMoon" : (14 + (47 + 13.8/60)/60) * 15,
                    "DecMoon" : -(15 + (42 + 37.4/60)/60),
                    
                    "dRaSun" : 9.6/3600 * 15,
                    "dDecSun": 43.3/3600,
                    "dRaMoon" : (2 + 23.6/60)/60 * 15,
                    "dDecMoon": -(15 + 15.7/60)/60,
                    
                    "ParallaxSun" : 8.72/3600,
                    "ParallaxMoon" : (61 + 14.1/60)/60,
                    
                    "MoonDiameter" : 2 / 60 * (16 + 41/60),
                    "SunDiameter" : 2 / 60 * (15 + 53/60),
                    
                    "oppositionJD" : AAJS.Date.DateToJD (1985, 05, 04, true) + (19 + 36.3/60)/24,
                    "eclipse" : true,
                    
                    'umbralRadius' : 46.3/60,
                    'penumbralRadius' : 78.7/60,

                    'y0' : (24 + 44.4/60)/60,
                    'dy' : -14.54/60,
                    'dx' : 32.25/60,
                    
                    'slope' : -14.54 / 32.25,
                    
                    'MoonPositions' : false,
                    'Timings' : false
            },
                  
            actualOutput : false,
            errors : [4e-3, 
                      2e-3, 
                      5e-3, 
                      3e-2, 
                      
                      2e-4, 
                      1e-4, 
                      1.1e-2, 
                      2e-2, 
                      
                      2e-6, 
                      4e-4, 
                      
                      5e-3, 
                      1e-3, 
                      
                      4e-3, 
                      0,
                      
                      2e-4,
                      8e-4,
                      
                      2.5e-2,
                      1.3e-2,
                      1e-2,
                      
                      3.1e-2,
                      
                      0,
                      0],
            test : function () {
                var i = 0;
                this.actualOutput = MoonEclipsesData.getOppositionAroundJD (this.input);
                this.actualOutput = MoonEclipsesData.addTimingsAndGeometry (this.actualOutput);
                this.actualOutput.MoonPositions = false;
                this.actualOutput.Timings = false;
                
                for (var key in this.expectedOutput) {
                    if (!testlib.doubleEq (this.actualOutput[key], 
                                           this.expectedOutput[key], 
                                           this.errors[i++])) {
                        return false;
                    }
                }
                return true;
            }
        },
        
        {
            name : "geometric and umbral timimgs for eclipse 1985-05-04",
            input : AAJS.Date.DateToJD (1985, 05, 04, true),
            expectedOutput : {
                    "RaSun" : (2 + (47 + 13.8/60)/60) * 15,
                    "DecSun" : 16 + (7 + 21.7/60)/60,
                    "RaMoon" : (14 + (47 + 13.8/60)/60) * 15,
                    "DecMoon" : -(15 + (42 + 37.4/60)/60),
                    
                    "dRaSun" : 9.6/3600 * 15,
                    "dDecSun": 43.3/3600,
                    "dRaMoon" : (2 + 23.6/60)/60 * 15,
                    "dDecMoon": -(15 + 15.7/60)/60,
                    
                    "ParallaxSun" : 8.72/3600,
                    "ParallaxMoon" : (61 + 14.1/60)/60,
                    
                    "MoonDiameter" : 2 / 60 * (16 + 41/60),
                    "SunDiameter" : 2 / 60 * (15 + 53/60),
                    
                    "oppositionJD" : AAJS.Date.DateToJD (1985, 05, 04, true) + (19 + 36.3/60)/24,
                    "eclipse" : true,
                    
                    'umbralRadius' : 46.3/60,
                    'penumbralRadius' : 78.7/60,

                    'y0' : (24 + 44.4/60)/60,
                    'dy' : -14.54/60,
                    'dx' : 32.25/60,
                    
                    'slope' : -14.54 / 32.25,
                    
                    'MoonPositions' : false,
                    'Timings' : {
                        'Umbral' : {
                            'firstContact' : AAJS.Date.DateToJD (1985, 05, 04, true) + (18 + 17/60)/24,
                            'beginFullImmersion' : AAJS.Date.DateToJD (1985, 05, 04, true) + (19 + 22/60)/24,
                            'endFullImmersion' : AAJS.Date.DateToJD (1985, 05, 04, true) + (20 + 30/60)/24,
                            'lastContact' : AAJS.Date.DateToJD (1985, 05, 04, true) + (21 + 36/60)/24,
                        },
                        'Penumbral' : {}
                    }
            },
                  
            actualOutput : false,
            geometricErrors : [4e-3, 
                      2e-3, 
                      5e-3, 
                      3e-2, 
                      
                      2e-4, 
                      1e-4, 
                      1.1e-2, 
                      2e-2, 
                      
                      2e-6, 
                      4e-4, 
                      
                      5e-3, 
                      1e-3, 
                      
                      4e-3, 
                      0,
                      
                      2e-4,
                      8e-4,
                      
                      2.5e-2,
                      1.3e-2,
                      1e-2,
                      
                      3.1e-2,
                      
                      0,
                      0],
                      
            timingErrors : [
                    5e-4,
                    1.2e-3,
                    9e-4,
                    9e-4
                ],

            test : function () {
                var i = 0;
                this.actualOutput = MoonEclipsesData.getOppositionAroundJD (this.input);
                this.actualOutput = MoonEclipsesData.addTimingsAndGeometry (this.actualOutput);
                this.actualOutput.MoonPositions = false;
                var timings = {'Umbral' : {}, 'Penumbral' : {} };
                
                for (var key in this.actualOutput.Timings.Umbral) {
                    timings['Umbral'][key] = this.actualOutput.Timings.Umbral[key];
                }

                for (var key in this.actualOutput.Timings.Penumbral) {
                    timings['Penumbral'][key] = this.actualOutput.Timings.Penumbral[key];
                }

                this.actualOutput.Timings = false;
                
                var expectedTimings = {'Umbral' : {}, 'Penumbral' : {} };
                
                for (var key in this.expectedOutput.Timings.Umbral) {
                    expectedTimings['Umbral'][key] = this.expectedOutput.Timings.Umbral[key];
                }

                for (var key in this.expectedOutput.Timings.Penumbral) {
                    expectedTimings['Penumbral'][key] = this.expectedOutput.Timings.Penumbral[key];
                }

                this.expectedOutput.Timings = false;
                
                
                for (var key in this.expectedOutput) {
                    if (!testlib.doubleEq (this.actualOutput[key], 
                                           this.expectedOutput[key], 
                                           this.geometricErrors[i++])) {
                        return false;
                    }
                }
                
                i = 0;
                this.actualOutput.Timings = timings;
                this.expectedOutput.Timings = expectedTimings;
                for (var key in this.expectedOutput.Timings.Umbral) {
                    if (!testlib.doubleEq (this.actualOutput.Timings.Umbral[key], 
                                           this.expectedOutput.Timings.Umbral[key], 
                                           this.timingErrors[i++])) {
                        return false;
                    }
                }
                
                return true;
            }
        },

       {
            name : "umbral timimgs for eclipse 2017-08-07",
            input : AAJS.Date.DateToJD (2017, 08, 07, true),
            expectedOutput : {
                    'firstContact' : AAJS.Date.DateToJD (2017, 08, 07, true) + (17 + (22+56/60)/60)/24,
                    'beginFullImmersion' : false,
                    'endFullImmersion' : false,
                    'lastContact' : AAJS.Date.DateToJD (2017, 08, 07, true) + (19 + (18+9/60)/60)/24,
                },
                  
            actualOutput : false,
                      
            timingErrors : [
                    5e-4,
                    0,
                    0,
                    1.7e-3
                ],

            test : function () {
                var i = 0;
                this.actualOutput = MoonEclipsesData.getOppositionAroundJD (this.input);
                this.actualOutput = MoonEclipsesData.addTimingsAndGeometry (this.actualOutput);
                this.actualOutput = this.actualOutput.Timings.Umbral;

                for (var key in this.expectedOutput) {
                    if (!testlib.doubleEq (this.actualOutput[key], 
                                           this.expectedOutput[key], 
                                           this.timingErrors[i++])) {
                        return false;
                    }
                }
                
                return true;
            }
        },

        ];
            
        testlib.runTests (tests);
    })();
                
        </script>

