<html>
<body>
<pre id="pre">
</pre>
</body>
</html>
<script src="js/occultablestars.js"></script>

<script>
function Tree (stars, granularityDeg) {
    var _granularityDeg = granularityDeg;
    var _raSlicesCount = Math.round(360 / granularityDeg);

    this.getRaIndex = function(RAh) {
        return Math.round(RAh * 15 / _granularityDeg);
    }

    this.getDecIndex = function(DEd) {
        return Math.round(DEd / _granularityDeg);
    }

    var tree = {};

    for (var i = 0; i < stars.length; i++) {
        var star = stars[i];
        var raIndex = this.getRaIndex(star.RAh);
        if (!tree[raIndex]) {
            tree[raIndex] = {};
        }
        var decIndex = this.getDecIndex(star.DEd);
        if (!tree[raIndex][decIndex]) {
            tree[raIndex][decIndex] = [];
        }
        tree[raIndex][decIndex].push(star);
    }
    
    this.getStarsNear = function (rah, ded) {
        var currentRaIndex = this.getRaIndex(rah);
        var currentDecIndex = this.getDecIndex(ded);

        var prevRaIndex = currentRaIndex - 1;
        if (prevRaIndex < 0) {
            prevRaIndex += _raSlicesCount;
        }

        var nextRaIndex = currentRaIndex + 1;
        if (nextRaIndex >= _raSlicesCount) {
            nextRaIndex -= _raSlicesCount;
        }

        var a = [];
        if (tree[currentRaIndex] && tree[currentRaIndex][currentDecIndex]) a = a.concat(tree[currentRaIndex][currentDecIndex]);
        if (tree[prevRaIndex] && tree[prevRaIndex][currentDecIndex] ) a = a.concat(tree[prevRaIndex][currentDecIndex] );
        if (tree[nextRaIndex] && tree[nextRaIndex][currentDecIndex] ) a = a.concat(tree[nextRaIndex][currentDecIndex] );
        if (tree[currentRaIndex] && tree[currentRaIndex][currentDecIndex + 1]) a = a.concat(tree[currentRaIndex][currentDecIndex + 1]);
        if (tree[prevRaIndex] && tree[prevRaIndex][currentDecIndex + 1] ) a = a.concat(tree[prevRaIndex][currentDecIndex + 1] );
        if (tree[nextRaIndex] && tree[nextRaIndex][currentDecIndex + 1] ) a = a.concat(tree[nextRaIndex][currentDecIndex + 1] );
        if (tree[currentRaIndex] && tree[currentRaIndex][currentDecIndex - 1]) a = a.concat(tree[currentRaIndex][currentDecIndex - 1]);
        if (tree[prevRaIndex] && tree[prevRaIndex][currentDecIndex - 1]) a = a.concat(tree[prevRaIndex][currentDecIndex - 1]);
        if (tree[nextRaIndex] && tree[nextRaIndex][currentDecIndex - 1] ) a = a.concat(tree[nextRaIndex][currentDecIndex - 1] );

        return a;
    };

}

var t = new Tree(OccultableStars.GetStars(), 0.5);
var a = t.getStarsNear(10,0);

</script>