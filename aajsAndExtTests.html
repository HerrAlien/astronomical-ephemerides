<html>
    <head>
        <script type="text/javascript" src="js/aajs.js"></script>
        <script type="text/javascript" src="testlib.js"></script>
        <style>
            p {
                line-spacing: 2px;
            }
        </style>
    </head>
    <body>
    </body>
</html>
<script type="text/javascript">


    function ValuesToPolynomialCoefficients_Forward (ValuesArray) {
        var coefficients = [];
        if (ValuesArray.length >= 4) {
        
            coefficients[0] = ValuesArray[0];
            coefficients[1] = ValuesArray[1] - ValuesArray[0];
            coefficients[2] = ValuesArray[2] - 2 * ValuesArray[1] + ValuesArray[0];
            coefficients[3] = ValuesArray[3] - 3 * ValuesArray[2] + 3 * ValuesArray[1] - ValuesArray[0];

            coefficients[2] /= 2;
            coefficients[3] /= 6;

        }
        
        return coefficients;
    }
            
    function ValuesToPolynomialCoefficients_Backward (ValuesArray) {
        var coefficients = [];
        if (ValuesArray.length >= 4) {
        
            coefficients[0] = ValuesArray[3];
            coefficients[1] = ValuesArray[3] - ValuesArray[2];
            coefficients[2] = ValuesArray[3] - 2 * ValuesArray[2] + ValuesArray[1];
            coefficients[3] = ValuesArray[3] - 3 * ValuesArray[2] + 3 * ValuesArray[1] - ValuesArray[0];

            coefficients[2] /= 2;
            coefficients[3] /= 6;

        }
        
        return coefficients;
    }
    
    function ValuesToPolynomialCoefficients_Average (ValuesArray) {
    
        var forwardValues = ValuesArray.slice (3, 7);
        var backwardValues = ValuesArray.slice (0, 4);
    
        var forwards = ValuesToPolynomialCoefficients_Forward(forwardValues);
        var backwards = ValuesToPolynomialCoefficients_Backward (backwardValues);

        return [ 0.5 * (backwards[0] + forwards[0]),
                 0.5 * (backwards[1] + forwards[1]),
                 0.5 * (backwards[2] + forwards[2]),
                 0.5 * (backwards[3] + forwards[3])];
    }

    (function () {
            
        var tests = [
        
        {
            name : "Date 2 JD and back 2 Date for 2017-01-01",
            input : [2017, 1, 1],
            expectedOutput : [2017, 1, 1],
            actualOutput : [],
            test : function () {
               var jd = AAJS.Date.DateToJD (this.input[0], this.input[1], this.input[2], true);
               var d = AAJS.Date.JD2Date (jd);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },

       {
            name : "Date 2 JD and back 2 Date for 2016-01-01",
            input : [2016, 1, 1],
            expectedOutput : [2016, 1, 1],
            actualOutput : [],
            test : function () {
               var jd = AAJS.Date.DateToJD (this.input[0], this.input[1], this.input[2], true);
               var d = AAJS.Date.JD2Date (jd);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },
 
       {
            name : "Date 2 JD and back 2 Date for 2012-01-01",
            input : [2012, 1, 1],
            expectedOutput : [2012, 1, 1],
            actualOutput : [],
            test : function () {
               var jd = AAJS.Date.DateToJD (this.input[0], this.input[1], this.input[2], true);
               var d = AAJS.Date.JD2Date (jd);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },

       {
            name : "Date 2 JD and back 2 Date for 1987-01-01",
            input : [1987, 1, 1],
            expectedOutput : [1987, 1, 1],
            actualOutput : [],
            test : function () {
               var jd = AAJS.Date.DateToJD (this.input[0], this.input[1], this.input[2], true);
               var d = AAJS.Date.JD2Date (jd);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },
        // 2446796.5
       {
            name : "JD 2 date for 2446796.5, 1987-01-01",
            input : 2446796.5,
            expectedOutput : [1987, 1, 1],
            actualOutput : [],
            test : function () {
               var d = AAJS.Date.JD2Date (this.input);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },
        
        // 2446796.5000000116
       {
            name : "JD 2 date for 2446796.5000000116, 1987-01-01",
            input : 2446796.5000000116,
            expectedOutput : [1987, 1, 1],
            actualOutput : [],
            test : function () {
               var d = AAJS.Date.JD2Date (this.input);
               this.actualOutput = [d.Y, d.M, d.D];
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        },
        {
				name : "eccentric anomaly",
				input : [357.02861 * Math.PI/180, 0.29039],
				expectedOutput : (360-4.18577) * Math.PI/180,
				actualOutput : 0 ,
				test : function () {
					this.actualOutput = AAJS['Elliptical']['EccentricAnomalyFromMeanAnomaly'] (this.input[0], this.input[1]);
					return testlib.doubleEq(this.expectedOutput, this.actualOutput, 2e-6);
				}
			},
            
        {
            name : "polynomial approximations for X^4+X^3+X^2+X+1 arround X=123, forward",
            input : {'value' : 123, 'func': function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
            }},
            expectedOutput : (function(){
                var inp = 123;
                var func = function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
                }
            
                var firstDerivative = function (x) {
                    return 1 + 2*x + 3*x*x + 4*x*x*x;
                }
                
                var secondDerivative = function (x) {
                    return 2 + 6 * x + 12 * x * x;
                }
                
                var thirdDerivative = function (x) {
                    return 6 + 24 * x;
                }
                
                return [func(inp),
                        firstDerivative(inp),
                        0.5 * secondDerivative(inp),
                        1/6.0 * thirdDerivative(inp)];
            
            })(),
            actualOutput : [],
            test : function () {
                var values = [this.input.func(this.input.value + 0),
                              this.input.func(this.input.value + 1),
                              this.input.func(this.input.value + 2),
                              this.input.func(this.input.value + 3)];
                              
               this.actualOutput = ValuesToPolynomialCoefficients_Forward(values);
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        }        ,
        {
            name : "polynomial approximations for X^4+X^3+X^2+X+1 arround X=123, backward",
            input : {'value' : 123, 'func': function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
            }},
            expectedOutput : (function(){
                var inp = 123;
                var func = function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
                }
            
                var firstDerivative = function (x) {
                    return 1 + 2*x + 3*x*x + 4*x*x*x;
                }
                
                var secondDerivative = function (x) {
                    return 2 + 6 * x + 12 * x * x;
                }
                
                var thirdDerivative = function (x) {
                    return 6 + 24 * x;
                }
                
                return [func(inp),
                        firstDerivative(inp),
                        0.5 * secondDerivative(inp),
                        1/6.0 * thirdDerivative(inp)];
            
            })(),
            actualOutput : [],
            test : function () {
                var values = [this.input.func(this.input.value - 3),
                              this.input.func(this.input.value - 2),
                              this.input.func(this.input.value - 1),
                              this.input.func(this.input.value)];
                              
               this.actualOutput = ValuesToPolynomialCoefficients_Backward(values);
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        }        
                ,
        {
            name : "polynomial approximations for X^4+X^3+X^2+X+1 arround X=123, average",
            input : {'value' : 123, 'func': function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
            }},
            expectedOutput : (function(){
                var inp = 123;
                var func = function (x) {
                return 1 + x + x*x + x*x*x + x*x*x*x;
                }
            
                var firstDerivative = function (x) {
                    return 1 + 2*x + 3*x*x + 4*x*x*x;
                }
                
                var secondDerivative = function (x) {
                    return 2 + 6 * x + 12 * x * x;
                }
                
                var thirdDerivative = function (x) {
                    return 6 + 24 * x;
                }
                
                return [func(inp),
                        firstDerivative(inp),
                        0.5 * secondDerivative(inp),
                        1/6.0 * thirdDerivative(inp)];
            
            })(),
            actualOutput : [],
            test : function () {
                var values = [
                                this.input.func(this.input.value - 3),
                                this.input.func(this.input.value - 2),
                                this.input.func(this.input.value - 1),
                                this.input.func(this.input.value + 0),
                              this.input.func(this.input.value + 1),
                              this.input.func(this.input.value + 2),
                              this.input.func(this.input.value + 3)];
                              
               this.actualOutput = ValuesToPolynomialCoefficients_Average(values);
               return JSON.stringify(this.expectedOutput) == JSON.stringify(this.actualOutput);
            }
        } 
        ];
            
        testlib.runTests (tests);
            
    })();
            
        </script>

